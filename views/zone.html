<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的生活账本-个人空间</title>
    <link rel="stylesheet" href="../vendor/bootstrap/css/bootstrap.css"/>
    <link rel="stylesheet" href="../dist/css/bootstrapValidator.css"/>
    <link href="../css/bootstrap-datetimepicker.min.css" rel="stylesheet">
    <link rel="icon" href="../img/dailyrecord.ico" type="image/x-icon">
</head>
<body>
<div class="container" id="app">


    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <!-- modal-sm来改变模态框的大小 -->
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">选择日期</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <select class="form-control" v-model="monthDate.year">
                            <option  v-for="n in yearNumbers">{{n}}</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <select class="form-control" v-model="monthDate.month">
                            <option  v-for="i in monthNumbers">{{i}}</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal" >关闭</button>
                    <button type="button" class="btn btn-danger" @click="choiceDate">选择</button>
                </div>
            </div>
        </div>
    </div>
    <!-- 顶部 -->
    <div class="col-lg-offset-2  col-lg-8">
        <ul class="nav navbar-nav pull-right">
            <li><a href="/home"><span class="glyphicon glyphicon-tasks"></span>我的生活账本</a></li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                    欢迎，<%=USER_NAME%>
                    <b class="caret"></b>
                </a>
                <ul class="dropdown-menu">
                    <li><a href="user/logout">退出</a></li>
                </ul>
            </li>
        </ul>
        <h3 class="text-muted">DailyRecord--记录点滴生活</h3>
    </div>

    <!-- 个人资料和本月收入-->
    <div class="col-lg-offset-2  col-lg-8 " style="margin-top: 20px;">
          <!-- 个人资料 用户名、加入时间、常住地点-->
          <div class="col-lg-3">
              <div class="list-group">
                  <a  class="list-group-item disabled">
                      <%=USER_NAME%>
                  </a>
                  <a  class="list-group-item">Address:新化</a>
                  <a class="list-group-item">Join:<%=USER_JOIN_TIME%></a>
              </div>
          </div>

          <!-- 本月支出和收入-->
          <div class="col-lg-9 panel panel-default"  style="height: 143px; background-color: #bce8f1">
              <div class="row col-lg-offset-1" data-toggle="modal" data-target="#myModal">
                  <div class="col-sm-6 col-md-4" id="month_sr_zc" style="margin-top: 10px">
                          <div class="caption">
                              <h3>{{monthDate.year}}</h3>
                              <p><h3>{{monthDate.month}}月</h3></p>
                          </div>
                  </div>
                  <div class="col-sm-6 col-md-4">
                      <div class="caption">
                          <h2>收入</h2>
                          <p><h2 style="color: #ff254a" v-cloak>+{{monthMoney.shouruMoney}}</h2></p>
                      </div>
                  </div>
                  <div class="col-sm-6 col-md-4">
                      <div class="caption">
                          <h2>支出</h2>
                          <p><h2 style="color: #09b4ff" v-cloak>-{{monthMoney.zhichuMoney}}</h2></p>
                      </div>
                  </div>
              </div>

          </div>
    </div>

    <div class="col-lg-offset-2  col-lg-8">
        <div class="col-lg-3">
            <div class="list-group">
                <a @click="zoneShow" :class="[showSign==1? 'list-group-item active':'list-group-item']">
                    个人中心
                </a>
                <a @click="zhichuShow" :class="[showSign==2? 'list-group-item active':'list-group-item']">我的支出</a>
                <a @click="shouruShow" :class="[showSign==3? 'list-group-item active':'list-group-item']">我的收入</a>
                <a href="#" class="list-group-item">心愿清单</a>
                <a href="#" class="list-group-item">个人资料</a>
            </div>
        </div>
        <!-- 不同的对应不同的模板-->
        <!-- 个人中心-->
        <div class="col-lg-9 panel panel-default" v-show="showSign==1">
                <!-- 明细、图表-->
                <!--<div class="btn-group btn-group-justified">-->
                    <!--<div class="btn-group">-->
                        <!--<button type="button" class="btn btn-default">趋势</button>-->
                    <!--</div>-->
                    <!--<div class="btn-group">-->
                        <!--<button type="button" class="btn btn-default">比重</button>-->
                    <!--</div>-->
                <!--</div>-->
                <!-- 图表或者明细-->
                <div id="zone" style="width: 500px;"></div>
        </div>

        <!-- 我的支出-->
        <!--<div class="col-lg-9" v-show="showSign==2">-->
        <div class="col-lg-9" v-show="showSign==2">

            <!-- 选择你想要的数据-->
            <div class="panel panel-primary">
                <div class="panel-heading" role="tab" id="headingOne">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseZhichu" aria-expanded="true" aria-controls="collapseZhichu">
                            我的支出
                        </a>
                    </h4>
                </div>
                <div id="collapseZhichu" class="panel-collapse collapse" role="tabpanel"  aria-labelledby="headingOne">

                    <div class="panel-body">
                        <div class="alert alert-danger" role="alert" v-show="zhichuValid.date">
                            <strong>Warning!</strong> 请选择相应的开始时间和结束时间
                        </div>
                        <div class="alert alert-danger" role="alert" v-show="zhichuValid.kind">
                            <strong>Warning!</strong> 请选择相应支出种类
                        </div>
                            <!-- 时间-->
                        <div class="form-group col-lg-12" style="margin-top: 20px;">
                            <div class="col-lg-1" style="margin-top: 10px;">
                                <span class="label label-danger">时间</span>
                            </div>
                            <div class="col-lg-4 col-lg-offset-1">
                                <input size="16" type="text"  id="zhichu_start_date" placeholder="开始时间"  readonly class="form-control form_datetime">
                            </div>
                            <div class="col-lg-1">
                                <span class="glyphicon glyphicon-arrow-left"></span>
                                <span class="glyphicon glyphicon-arrow-right"></span>
                            </div>
                            <div class="col-lg-4">
                                <input size="16" type="text"  id="zhichu_end_date" placeholder="结束时间"  readonly class="form-control form_datetime">
                            </div>
                        </div>

                        <!-- 支出类别-->
                        <div class="form-group col-lg-12" >
                            <div class="col-lg-1">
                                <span class="label label-danger">支付</span>
                            </div>
                            <ul class="nav nav-pills small" style="margin-left: 80px;">
                                <li role="presentation" :class="[zhichu[0].show?'active':'']" ><a @click="zhichuChoice(0)">一日三餐</a></li>
                                <li role="presentation" :class="[zhichu[1].show?'active':'']" style="margin-left: 30px"><a @click="zhichuChoice(1)">日常用品</a></li>
                                <li role="presentation" :class="[zhichu[4].show?'active':'']" style="margin-left: 30px"><a @click="zhichuChoice(4)">生活其他</a></li>
                            </ul>
                            <ul class="nav nav-pills small" style="margin-left: 80px; margin-top: 10px;">
                                <li role="presentation" :class="[zhichu[2].show?'active':'']" ><a @click="zhichuChoice(2)">交通</a></li>
                                <li role="presentation" :class="[zhichu[3].show?'active':'']" style="margin-left: 55px"><a @click="zhichuChoice(3)">衣着</a></li>
                                <li role="presentation" :class="[zhichu[5].show?'active':'']" style="margin-left: 55px"><a @click="zhichuChoice(5)">书籍</a></li>
                            </ul>
                        </div>

                        <!-- 明细图表-->
                        <div class="form-group col-lg-12">
                            <div class=" col-lg-10 col-lg-offset-4">
                                <div class="btn-group btn-group">
                                    <div class="btn-group">
                                        <button type="button" @click="getZhichuList(1)" class="btn btn-default">明细</button>
                                    </div>
                                    <div class="btn-group">
                                        <button @click="getZhichuChart()" type="button"  class="btn btn-default ">图表</button>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-link" @click="zhichuReset">重置</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 如果你所选择的没有相应数据-->
            <div v-show="noZhiChu==true">
                <div class="alert alert-info" role="alert">
                    没有相应数据
                </div>
            </div>

            <!-- 列表数据-->
            <div v-show="chartFlag==false">
                <table  class="table table-hover text-center">
                    <tbody>
                        <tr>
                            <td><strong>时间</strong></td>
                            <td><strong>内容</strong></td>
                            <td><strong>类别</strong></td>
                            <td><strong>金额</strong></td>
                        </tr>
                        <tr v-for="item in zhichuList">
                            <td>{{item.HF_DATE}}</td>
                            <td>{{item.HF_CONTENT}}</td>
                            <td>{{getzhichuKind(item.HF_KIND)}}</td>
                            <td><button type="button" class="btn btn-xs btn-danger">{{item.HF_MONEY}}元</button></td>
                        </tr>
                    </tbody>
                    <tfoot>
                    <td colspan="4">
                    <nav>
                        <!--zhichuPageNow-->
                        <ul class="pagination" v-for="item in zhuchiPages">
                            <li v-if="item=='上一页'">
                                <a @click="getZhichuList(zhichuPageNow-1)">{{item}}</a>
                            </li>
                            <li v-if="item=='下一页'">
                                <a @click="getZhichuList(zhichuPageNow+1)">{{item}}</a>
                            </li>
                            <li v-if="(item!='上一页')&&(item!='下一页')" :class="[item==zhichuPageNow?'active':'']">
                                <a @click="getZhichuList(item)">{{item}}</a>
                            </li>
                            <!--<li><a> &lt;</a></li>-->
                            <!--<li class="active"><a href="#">1</a></li>-->
                            <!--<li><a href="#">2</a></li>-->
                            <!--<li><a href="#">3</a></li>-->
                            <!--<li><a href="#">4</a></li>-->
                            <!--<li><a href="#">5</a></li>-->
                            <!--<li><a>&gt;</a></li>-->
                            <!--<li><a href="#">&raquo;</a></li>-->
                            <!--<li><a>共10页</a></li>-->
                        </ul>
                    </nav>
                    </td>
                    </tfoot>
                </table>
            </div>

            <!-- 图表数据-->
            <div v-show="chartFlag==true">
                <div  id="zhichuColumn" style="width: 500px;"></div>
                <div  id="zhichuPie" style="width: 500px;"></div>
            </div>
        </div>

        <!-- 我的收入-->
        <div class="col-lg-9" v-show="showSign==3">
            <div class="panel panel-primary">
                <div class="panel-heading" role="tab" id="headingTwo">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseShouru" aria-expanded="true" aria-controls="collapseZhichu">
                            我的收入
                        </a>
                    </h4>
                </div>
                <div id="collapseShouru" class="panel-collapse collapse" role="tabpanel"  aria-labelledby="headingOne">

                        <div class="panel-body">
                            <div class="alert alert-danger" role="alert" v-show="shouruValid.date">
                                <strong>Warning!</strong> 请选择相应的开始时间和结束时间
                            </div>
                            <div class="alert alert-danger" role="alert" v-show="shouruValid.kind">
                                <strong>Warning!</strong> 请选择相应收入种类
                            </div>
                            <div class="form-group col-lg-12" style="margin-top: 20px;">
                                <div class="col-lg-1" style="margin-top: 10px;">
                                    <span class="label label-danger">时间</span>
                                </div>
                                <div class="col-lg-4 col-lg-offset-1">
                                    <input size="16" type="text"  id="shouru_start_date" placeholder="开始时间"  readonly class="form-control form_datetime">
                                </div>
                                <div class="col-lg-1">
                                    <span class="glyphicon glyphicon-arrow-left"></span>
                                    <span class="glyphicon glyphicon-arrow-right"></span>
                                </div>
                                <div class="col-lg-4">
                                    <input size="16" type="text"  id="shouru_end_date" placeholder="结束时间"  readonly class="form-control form_datetime">
                                </div>
                            </div>

                            <div class="form-group col-lg-12" >
                                <div class="col-lg-1" style="margin-top: 10px;">
                                    <span class="label label-danger">收入</span>
                                </div>
                                <ul class="nav nav-pills small" style="margin-left: 80px;" role="tablist">
                                    <li role="presentation" :class="[shouru[0].show?'active':'']" ><a @click="shouruChoice(0)">工资</a></li>
                                    <li role="presentation" :class="[shouru[1].show?'active':'']"  style="margin-left: 30px"><a @click="shouruChoice(1)">补贴</a></li>
                                    <li role="presentation" :class="[shouru[2].show?'active':'']"  style="margin-left: 30px"><a @click="shouruChoice(2)">项目奖金</a></li>
                                    <li role="presentation" :class="[shouru[3].show?'active':'']"  style="margin-left: 30px"><a @click="shouruChoice(3)">其他</a></li>
                                </ul>
                            </div>
                            <div class="form-group col-lg-12">
                                <div class=" col-lg-10 col-lg-offset-4">
                                    <div class="btn-group btn-group">
                                        <div class="btn-group">
                                            <button type="button" @click="getShouruList(1)"  class="btn btn-default">明细</button>
                                        </div>
                                        <div class="btn-group">
                                            <button  type="button" @click="getShouruChart"  class="btn btn-default">图表</button>
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-link" @click="shouruReset">重置</button>
                                </div>
                            </div>
                        </div>

                </div>
            </div>

            <!-- 如果你所选择的没有相应数据-->
            <div v-show="noShouRu==true">
                <div class="alert alert-info" role="alert">
                    没有相应数据
                </div>
            </div>

            <!-- 列表数据-->
            <div v-show="chartFlag==false">
                <table  class="table table-hover text-center">
                    <tbody>
                    <tr>
                        <td><strong>时间</strong></td>
                        <td><strong>内容</strong></td>
                        <td><strong>类别</strong></td>
                        <td><strong>金额</strong></td>
                    </tr>
                    <tr v-for="item in shouruList">
                        <td>{{item.SR_DATE}}</td>
                        <td>{{item.SR_CONTENT}}</td>
                        <td>{{getshouruKind(item.SR_KIND)}}</td>
                        <td><button type="button" class="btn btn-xs btn-danger">{{item.SR_MONEY}}元</button></td>
                    </tr>
                    </tbody>
                    <tfoot>
                    <td colspan="4">
                        <nav>
                            <ul class="pagination" v-for="item in shouruPages">
                                <li v-if="item=='上一页'">
                                    <a @click="getShouruList(shouruPageNow-1)">{{item}}</a>
                                </li>
                                <li v-if="item=='下一页'">
                                    <a @click="getShouruList(shouruPageNow+1)">{{item}}</a>
                                </li>
                                <li v-if="(item!='上一页')&&(item!='下一页')" :class="[item==shouruPageNow?'active':'']">
                                    <a @click="getShouruList(item)">{{item}}</a>
                                </li>
                                <!--<li><a href="#">&laquo;</a></li>-->
                                <!--<li><a href="#">1</a></li>-->
                                <!--<li><a href="#">2</a></li>-->
                                <!--<li><a href="#">3</a></li>-->
                                <!--<li><a href="#">4</a></li>-->
                                <!--<li><a href="#">5</a></li>-->
                                <!--<li><a href="#">&raquo;</a></li>-->
                            </ul>
                        </nav>
                    </td>
                    </tfoot>
                </table>
            </div>

            <div v-show="chartFlag==true">
                <div  id="shouruColumn" style="width: 500px;"></div>
                <div  id="shouruPie" style="width: 500px;"></div>
            </div>
        </div>

        <!-- 心愿清单-->
</div>

</div>
<script type="text/javascript" src="../vendor/jquery/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="../vendor/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../dist/js/bootstrapValidator.js"></script>
<script src="../js/bootstrap-datetimepicker.min.js" type="text/javascript"></script>
<script type="text/javascript" src="../js/highcharts.js"></script>
<script type="text/javascript" src="../js/comm.js"></script>
<script src="../js/vue.js" type="text/javascript"></script>
<script src="../js/vue-resource.min.js" type="text/javascript"></script>
<script language="JavaScript">

    var zone = new Vue({
        el:"#app",
        data:{
            zhichuPageNow:1,
            zhuchiPages:[],
            noZhiChu:false,
            noShouRu:false,
            shouruPageNow:1,
            shouruPages:[],
//          支出选择验证
            zhichuValid:{date:false,kind:false},
//          收入选择验证
            shouruValid:{date:false,kind:false},

            monthDate:{
                year:new Date().getFullYear(),
                month:(new Date().getMonth()+1)>=10?new Date().getMonth()+1:'0'+(new Date().getMonth()+1)
            },
//          表示不同的模块
            showSign:1,
//          列表和图的标志
            chartFlag:null,
//          用来辨识选额的种类
            zhichu:[{show:false},{show:false},{show:false},
                    {show:false},{show:false},{show:false}],

            shouru:[{show:false},{show:false},{show:false},{show:false}],

            monthMoney:{zhichuMoney:0,shouruMoney:0},

            zhichuList:[{}],

            shouruList:[{}],
        },
        computed:{
//          设置年份从1984开始
            yearNumbers:function(){
                var year = new Array();
                for(var i = 1984;i<=(new Date().getFullYear());i++){
                    year.push(i);
                }
                return year;
            },
//          设置月份
            monthNumbers: function () {
                var month = new Array();
                for(var i=1;i<=12;i++){
                    var temp="";
                    if(i<10){
                        temp = "0"+i
                        month.push(temp);
                    }else{
                        month.push(i);
                    }

                }
                return month;
            }

        },
        mounted:function(){
            this.zoneShow();
        },
        methods:{
            getzhichuKind:function(HF_KIND){
                switch (HF_KIND) {
                    case "1":return "一日三餐"; break;
                    case "2":return "日常用品"; break;
                    case "3":return "交通"; break;
                    case "4":return "衣着"; break;
                    case "5":return "生活其他"; break;
                    case "6":return "书籍"; break;
                }
            },

            getshouruKind:function(SR_KIND){
                switch (SR_KIND) {
                    case "1":return "工资"; break;
                    case "2":return "补贴"; break;
                    case "3":return "项目奖金"; break;
                    case "4":return "其他"; break;
                }
            },
//            选择日期显示相应的年月
            choiceDate:function(){
                this.zoneMoenyShow(this.monthDate);
                $('#myModal').modal('hide');
            },
//          用来显示当月的收入和支出
            zoneMoenyShow:function(monthDate){
                this.$http.post('/zone/monthMoney',{monthDate:monthDate})
                        .then(function(response){
                            this.monthMoney.zhichuMoney = response.data.zhichuMoney;
                            this.monthMoney.shouruMoney = response.data.shouruMoney;
                            this.monthDate = monthDate;
                        })
                        .catch(function(response){

                        })
            },

            shouruReset:function(){
                this.noShouRu = false;
                this.shouruValid.date = false;
                this.shouruValid.kind = false;
                for(var i=0;i<this.shouru.length;i++){
                    this.shouru[i].show = false;
                }
                $('#shouru_end_date').val("");
                $('#shouru_start_date').val("");
                this.chartFlag = null;
            },

            zhichuReset:function(){
                this.zhichuValid.date = false;
                this.zhichuValid.kind = false;
                this.noZhiChu = false;
                for(var i=0;i<this.zhichu.length;i++){
                    this.zhichu[i].show = false;
                }
                $('#zhichu_end_date').val("");
                $('#zhichu_start_date').val("");
                this.chartFlag = null;
            },

            zhichuChoice:function(i){
                this.zhichu[i].show=!this.zhichu[i].show;
            },

            shouruChoice:function(i){
                this.shouru[i].show=!this.shouru[i].show;
            },

            getShouruList:function(page){
                this.shouruPageNow = page;
                var shouru = this.shouru;
                var SR_KIND = new Array();
                for(var i=0;i<shouru.length;i++){
                    if(shouru[i].show==true){
                        SR_KIND.push(i+1);
                    }
                }
                var shouru_start_date = $("#shouru_start_date").val();
                var shouru_end_date = $("#shouru_end_date").val();
                if(this.shouru_valid(SR_KIND)){
                    this.$http.post('/zone/shouruList',
                            {
                                SR_KIND:SR_KIND,
                                shouru_start_date:shouru_start_date,
                                shouru_end_date:shouru_end_date,
                                shouruPageNow:this.shouruPageNow
                            })
                            .then(function(response){
                                if(response.data.shouruAll==0){
                                    this.noShouRu = true;
                                    $('#collapseShouru').collapse('show');
                                    this.chartFlag=null;
                                }else{
                                    this.noShouRu = false;
                                    var shouruTotal = response.data.shouruAll;
                                    this.shouruPages = showPages(parseInt(page),parseInt(shouruTotal));
                                    this.shouruList = response.data.shouruList;
                                    $('#collapseShouru').collapse('hide');
                                    this.chartFlag=false;
                                }

                            })
                            .catch(function(response){

                            })
                }else{
                    $('#collapseShouru').collapse('show');
                    this.chartFlag=null;
                };

            },

            getShouruChart:function(){
                var shouru = this.shouru;
                var SR_KIND = new Array();
                for(var i=0;i<shouru.length;i++){
                    if(shouru[i].show==true){
                        SR_KIND.push(i+1);
                    }
                }
                var shouru_start_date = $("#shouru_start_date").val();
                var shouru_end_date = $("#shouru_end_date").val();
                if(this.shouru_valid(SR_KIND)){
                    this.$http.post("/zone/shouruChart",
                            {
                                SR_KIND:SR_KIND,
                                shouru_start_date:shouru_start_date,
                                shouru_end_date:shouru_end_date,
                                shouruPageNow:this.shouruPageNow
                            })
                            .then(function(response){

                                if(response.data.shouruChart==""){
                                    this.noShouRu = true;
                                    $('#collapseShouru').collapse('show');
                                    this.chartFlag=null;
                                }else{
                                    this.noShouRu = false;
                                    $('#collapseShouru').collapse('hide');
                                    this.shouruColumneData(response.data.shouruChart);
                                    this.shouruPieData(response.data.shouruChart);
                                    this.chartFlag=true;
                                }

                            })
                            .catch(function(response){

                            })
                }else{
                    $('#collapseShouru').collapse('show');
                    this.chartFlag=null;
                };


            },

            shouruShow:function(){
                this.shouruReset();
                $('#collapseShouru').collapse('show');
                this.showSign=3;
            },

            getZhichuList:function(page){
                this.zhichuPageNow = page;
                var zhichu = this.zhichu;
                var HF_KIND = new Array();
                for(var i=0;i<zhichu.length;i++){
                    if(zhichu[i].show==true){
                        HF_KIND.push(i+1);
                    }
                }
                var zhichu_start_date = $("#zhichu_start_date").val();
                var zhichu_end_date = $("#zhichu_end_date").val();
                if(this.zhichu_valid(HF_KIND)){
                    this.$http.post('/zone/zhichuList',
                            {
                                HF_KIND:HF_KIND,
                                zhichu_start_date:zhichu_start_date,
                                zhichu_end_date:zhichu_end_date,
                                zhichuPageNow:this.zhichuPageNow
                            })
                        .then(function(response){
                                if(response.data.zhichuAll==0){
                                    this.noZhiChu = true;
                                    $('#collapseZhichu').collapse('show');
                                    this.chartFlag=null;
                                }else{
                                    this.noZhiChu = false;
                                    var zhichuTotal = response.data.zhichuAll;
                                    this.zhichuList = response.data.zhichuList;
                                    this.zhuchiPages = showPages(parseInt(page),parseInt(zhichuTotal));
                                    $('#collapseZhichu').collapse('hide');
                                    this.chartFlag=false;
                                }
                            })
                        .catch(function(response){

                            })
                }else{
                    $('#collapseZhichu').collapse('show');
                    this.chartFlag=null;
                }
//                console.log(this.zhichu_valid(HF_KIND));
            },
//           支出验证
            zhichu_valid:function(HF_KIND){
                var flag = false;
                console.log($("#zhichu_start_date").val()=="");
                console.log($("#zhichu_end_date").val()=="");
                if(($("#zhichu_start_date").val()=="")||($("#zhichu_end_date").val()=="")){
                    this.zhichuValid.date=true;
                    flag = false;
                }else{
                    this.zhichuValid.date=false;
                    flag = true;
                }

                if(HF_KIND.length==0){
                    this.zhichuValid.kind=true;
                    flag = false;
                }else{
                    this.zhichuValid.kind=false;
                    flag = true;
                }
                return flag;
            },

            getZhichuChart:function(){
                var zhichu = this.zhichu;
                var HF_KIND = new Array();
                for(var i=0;i<zhichu.length;i++){
                    if(zhichu[i].show==true){
                        HF_KIND.push(i+1);
                    }
                }
                var zhichu_start_date = $("#zhichu_start_date").val();
                var zhichu_end_date = $("#zhichu_end_date").val();
                if(this.zhichu_valid(HF_KIND)){
                    this.$http.post('/zone/zhichuChart',
                            {
                                HF_KIND:HF_KIND,
                                zhichu_start_date:zhichu_start_date,
                                zhichu_end_date:zhichu_end_date
                            })
                            .then(function(response){
                                if(response.data.zhichuChart==""){
                                    this.noZhiChu = true;
                                    $('#collapseZhichu').collapse('show');
                                    this.chartFlag=null;

                                }else{
                                    this.noZhiChu = false;
                                    $('#collapseZhichu').collapse('hide');
                                    this.chartFlag=true;
//                                console.log("test"+response.data.zhichuChart);
                                    this.zhichuColumneData(response.data.zhichuChart);
                                    this.zhichuPieData(response.data.zhichuChart);
                                }
                            })
                            .catch(function(response){

                            })
                }else{
                    $('#collapseZhichu').collapse('show');
                    this.chartFlag=null;
                }

            },

            zoneShow:function(){
                this.$http.post('/zone/yearMoney')
                        .then(function(response){
//                            console.log(response.data.money);
                            this.zoneData(response.data.zhichu_money,response.data.shoru_money);
                        })
                        .catch(function(response){

                        })

                this.zoneMoenyShow(this.monthDate);
                this.chartFlag=null;
                this.showSign=1;
            },

            shouru_valid:function(SR_KIND){
                var flag = false;
                console.log($("#shouru_start_date").val()=="");
                console.log($("#shouru_end_date").val()=="");
                if(($("#shouru_start_date").val()=="")||($("#shouru_end_date").val()=="")){
                    this.shouruValid.date=true;
                    flag = false;
                }else{
                    this.shouruValid.date=false;
                    flag = true;
                }

                if(SR_KIND.length==0){
                    this.shouruValid.kind=true;
                    flag = false;
                }else{
                    this.shouruValid.kind=false;
                    flag = true;
                }
                return flag;
            },

            zhichuShow:function(){
                this.showSign=2;
                this.zhichuReset();
//                this.zhichu=[{show:false},{show:false},{show:false},
//                    {show:false},{show:false},{show:false}],
//                $('#zhichu_start_date').val("");
//                $('#zhichu_end_date').val("")
                $('#collapseZhichu').collapse('show');
            },

            zoneData:function(zc_money,sr_money){
                var text = this.monthDate.year+" 收入|支出";
                var title = {
                    text: text
                };
                var subtitle = {
                    text: 'Source: DailyRecord'
                };
                var xAxis = {
                    categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
                        'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
                };
                var yAxis = {
                    title: {
                        text: 'Money'
                    }
                };
                var plotOptions = {
                    line: {
                        dataLabels: {
                            enabled: true
                        },
                        enableMouseTracking: false
                    }
                };
                var series= [{
                    name: '支出',
                    data: zc_money
                }, {
                    name: '收入',
                    data: sr_money
                }
                ];

                var json = {};
                json.title = title;
                json.subtitle = subtitle;
                json.xAxis = xAxis;
                json.yAxis = yAxis;
                json.series = series;
                json.plotOptions = plotOptions;
                $('#zone').highcharts(json);
            },

//          支出柱形图
            zhichuColumneData:function(zhichuChart){
                var title = {
                    text: '支出柱形图'
                };
                var subtitle = {
                    text: 'Source: DailyRecord'
                };
                var xAxis = {
                    type: 'category',
                    categories: ['一日三餐','日常用品','交通','衣着','生活其他','书籍'],
                }
                var yAxis = {
                    title: {
                        text: 'Money (RMB)'
                    }
                };
                var plotOptions = {
                    series: {
                        colorByPoint:true,
                        animation:true,
                        dataLabels: {"enabled":true}
                    },

                };
                var series= [
                    {
                        data:zhichuChart,
                        name: '金额',
                        showInLegend: false,
                    }
                ];

                var chart = {
                    type: 'column'
                };

                var credits={
                    href:"#",
                    text:"www.DailyRecord.com"
                };
                var json = {};

                json.title = title;
                json.subtitle = subtitle;
                json.xAxis = xAxis;
                json.yAxis = yAxis;
                json.series = series;
                json.plotOptions = plotOptions;
                json.chart = chart;
                json.credits = credits;
                $('#zhichuColumn').highcharts(json);
            },

//          支出饼图
            zhichuPieData:function(zhichuChart){
                var chart = {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false
                };
                var title = {
                    text: '支出所占比重'
                };
                var tooltip = {
                    pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                };
                var plotOptions = {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: false
                        },
                        showInLegend: true
                    }
                };
                var series= [{
                    type: 'pie',
                    name: '所占比重',
                    data: zhichuChart,
                }];

                var json = {};
                json.chart = chart;
                json.title = title;
                json.tooltip = tooltip;
                json.series = series;
                json.plotOptions = plotOptions;
                $('#zhichuPie').highcharts(json);
            },

            //          支出柱形图
            shouruColumneData:function(shouruChart){
                var title = {
                    text: '收入柱形图'
                };
                var subtitle = {
                    text: 'Source: DailyRecord'
                };
                var xAxis = {
                    type: 'category',
                    categories: ['工资','补贴','项目奖金','其他'],
                }
                var yAxis = {
                    title: {
                        text: 'Money (RMB)'
                    }
                };
                var plotOptions = {
                    series: {
                        colorByPoint:true,
                        animation:true,
                        dataLabels: {"enabled":true}
                    },

                };
                var series= [
                    {
                        data:shouruChart,
                        name: '金额',
                        showInLegend: false,
                    }
                ];

                var chart = {
                    type: 'column'
                };

                var credits={
                    href:"#",
                    text:"www.DailyRecord.com"
                };
                var json = {};

                json.title = title;
                json.subtitle = subtitle;
                json.xAxis = xAxis;
                json.yAxis = yAxis;
                json.series = series;
                json.plotOptions = plotOptions;
                json.chart = chart;
                json.credits = credits;
                $('#shouruColumn').highcharts(json);
            },

            shouruPieData:function(shouruChart){
                var chart = {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false
                };
                var title = {
                    text: '收入所占比重'
                };
                var tooltip = {
                    pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                };
                var plotOptions = {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: false
                        },
                        showInLegend: true
                    }
                };
                var series= [{
                    type: 'pie',
                    name: '所占比重',
                    data: shouruChart
                }];

                var json = {};
                json.chart = chart;
                json.title = title;
                json.tooltip = tooltip;
                json.series = series;
                json.plotOptions = plotOptions;
                $('#shouruPie').highcharts(json);
            },

        }

    });

    $('#shouru_start_date').datetimepicker({
        format:'yyyy-mm-dd',
        language:  'zh-CN',
        weekStart: 1,
        todayBtn:  1,
        autoclose: 1,
        todayHighlight: 1,
        startView: 2,
        minView:2,
        'endDate':new Date()
    }).on("changeDate",function(ev){
        var transferdate=transferDate($("#shouru_end_date").val());//转时间日期
        $('#shouru_end_date').datetimepicker('remove');
        $('#shouru_end_date').datetimepicker({
            format: 'yyyy-mm-dd',
            language:  'zh-CN',
            minView:2,
            autoclose: 1,
            'startDate':transferdate,
            'endDate':new Date(),
            todayBtn:  1
        }).on("changeDate",function(ev){
            var enddate=$("#shouru_end_date").val();
            shouruSetEndTime(enddate);
        });
    });


    $('#shouru_end_date').datetimepicker({
        format:'yyyy-mm-dd',
        language:  'zh-CN',
        minView:2,
        autoclose: 1,
        'endDate':new Date(),
        todayBtn:  1
    }).on("changeDate",function(ev){
        var enddate=$("#shouru_end_date").val();
        shouruSetEndTime(enddate);
    });

    function shouruSetEndTime(enddate){
        $('#shouru_start_date').datetimepicker('remove');
        $('#shouru_start_date').datetimepicker({
            format: 'yyyy-mm-dd',
            language:  'zh-CN',
            autoclose: 1,
            todayHighlight: 1,
            minView:2,
            forceParse: 0,
            'endDate': transferDate(enddate)
        });
    }

//    开始时间和结束时间
    $('#zhichu_start_date').datetimepicker({
        format:'yyyy-mm-dd',
        language:  'zh-CN',
        weekStart: 1,
        todayBtn:  1,
        autoclose: 1,
        todayHighlight: 1,
        startView: 2,
        minView:2,
        'endDate':new Date()
    }).on("changeDate",function(ev){
        var transferdate=transferDate($("#zhichu_start_date").val());//转时间日期
        $('#zhichu_end_date').datetimepicker('remove');
        $('#zhichu_end_date').datetimepicker({
            format: 'yyyy-mm-dd',
            language: 'zh-CN',
            minView:2,
            autoclose: 1,
            'startDate':transferdate,
            'endDate':new Date(),
            todayBtn:  1
        }).on("changeDate",function(ev){
            var enddate=$("#zhichu_end_date").val();
            zhichuSetEndTime(enddate);
        });
    });


    $('#zhichu_end_date').datetimepicker({
        format:'yyyy-mm-dd',
        language:  'zh-CN',
        minView:2,
        autoclose: 1,
        'endDate':new Date(),
        todayBtn:  1
    }).on("changeDate",function(ev){
        var enddate=$("#zhichu_end_date").val();
        zhichuSetEndTime(enddate);
    });
    function zhichuSetEndTime(enddate){
        $('#zhichu_start_date').datetimepicker('remove');
        $('#zhichu_start_date').datetimepicker({
            format: 'yyyy-mm-dd',
            language:  'zh-CN',
            autoclose: 1,
            todayHighlight: 1,
            minView:2,
            forceParse: 0,
            'endDate': transferDate(enddate)
        });
    }
    //将时间字符串转为date
    function transferDate(data){
        var start_time=data;
        var newTime= start_time.replace(/-/g,"-");
        var transferdate = new Date(newTime);
        return transferdate;
    }
    function transferTime(str){
        var newstr=str.replace(/-/g,'-');
        var newdate=new Date(newstr);
        var time=newdate.getTime();
        return time;
    }
</script>
</body>
</html>